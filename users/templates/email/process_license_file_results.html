{% load tz %}
{% comment %}
Context expected:
    orgfile: OrgFile instance for the uploaded file
    stats: dict {num_new:int, num_upd:int, num_no_action:int}
    num_errors: int - number of errors during process step
    create_errors: list of dicts that had license create errors
    update_errors: list of dicts that had license update errors
    support_email: email address
{% endcomment %}
<div>
    <p>Confirmation - {{ orgfile.file_type }} file processed.</p>
    {% timezone "America/Los_Angeles" %}
    <table>
        <tr>
            <th align="right">Date of upload</th>
            <td>{{ orgfile.created|date:"D, d N Y H:i e" }}</td>
        </tr>
        <tr>
            <th align="right">Uploaded by</th>
            <td>{{ orgfile.user.profile.getFullName }}</p>
        </tr>
        <tr>
            <th align="right">Organization</th>
            <td>{{ orgfile.organization.name }}</p>
        </tr>
        <tr>
            <th align="right">File Name</th>
            <td>{{ orgfile.name }}</p>
        </tr>
        <tr>
            <th align="right">Licenses added</th>
            <td>{{ stats.num_new }}</p>
        </tr>
        <tr>
            <th align="right">Licenses updated</th>
            <td>{{ stats.num_upd }}</p>
        </tr>
        <tr>
            <th align="right">Licenses un-changed</th>
            <td>{{ stats.num_no_action }}</p>
        </tr>
        <tr>
            <th align="right">Licenses removed</th>
            <td>0</p>
        </tr>
    </table>
    {% endtimezone %}
    {% if num_errors %}
        <h4>The following licenses resulted in a processing error ({{ num_errors }} errors total)</h4>:
    {% endif %}
    {% for d in create_errors %}
        <p>{{ d.npiNumber }}|{{ d.lastName }}|{{ d.firstName }}|{{ d.state }}|{{ d.licenseNumber }}|{{ d.expireDate|date:"m/d/Y" }}</p>
    {% endfor %}

    {% for d in update_errors %}
        <p>{{ d.npiNumber }}|{{ d.lastName }}|{{ d.firstName }}|{{ d.state }}|{{ d.licenseNumber }}|{{ d.expireDate|date:"m/d/Y" }}</p>
    {% endfor %}
    {% include "email/mailto_support_snippet.html" %}
</div>
